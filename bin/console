#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'dhan_scalper'

# Development console for dhan_scalper
# This console provides an interactive environment for testing and development

puts 'ðŸš€ DhanScalper Development Console'
puts '=' * 50
puts 'Available components:'
puts 'â€¢ DhanScalper::Config'
puts 'â€¢ DhanScalper::BalanceProviders::PaperWallet'
puts 'â€¢ DhanScalper::BalanceProviders::LiveBalance'
puts 'â€¢ DhanScalper::Brokers::PaperBroker'
puts 'â€¢ DhanScalper::Brokers::DhanBroker'
puts 'â€¢ DhanScalper::VirtualDataManager'
puts 'â€¢ DhanScalper::TickCache'
puts 'â€¢ DhanScalper::CLI'
puts '=' * 50

# Load development configuration if available
begin
  if File.exist?('config/development.yml')
    puts 'ðŸ“ Loading development config...'
    @config = DhanScalper::Config.load(path: 'config/development.yml')
    puts 'âœ“ Development config loaded'
  else
    puts 'âš  No development config found. Create config/development.yml for testing'
  end
rescue StandardError => e
  puts "âš  Config loading failed: #{e.message}"
end

# Set up some common objects for testing
begin
  puts 'ðŸ”§ Setting up test objects...'

  # Paper wallet for testing
  @paper_wallet = DhanScalper::BalanceProviders::PaperWallet.new(100_000)
  puts 'âœ“ Paper wallet created with â‚¹100,000'

  # Virtual data manager
  @vdm = DhanScalper::VirtualDataManager.new
  puts 'âœ“ Virtual data manager created'

  # Paper broker
  @paper_broker = DhanScalper::Brokers::PaperBroker.new(
    virtual_data_manager: @vdm,
    balance_provider: @paper_wallet
  )
  puts 'âœ“ Paper broker created'

  # Sample tick data
  DhanScalper::TickCache.put({
                               segment: 'IDX_I',
                               security_id: '13',
                               ltp: 19_500.0,
                               ts: Time.now.to_i,
                               symbol: 'NIFTY'
                             })
  puts 'âœ“ Sample tick data added'
rescue StandardError => e
  puts "âš  Setup failed: #{e.message}"
end

puts "\nðŸŽ¯ Ready for development! Try these examples:"
puts "â€¢ @config['symbols']                    # View symbols"
puts 'â€¢ @paper_wallet.available_balance      # Check paper balance'
puts 'â€¢ @vdm.get_balance                     # Get VDM balance'
puts "â€¢ DhanScalper::TickCache.ltp('IDX_I', '13')  # Get NIFTY LTP"
puts "â€¢ @paper_broker.buy_market(segment: 'NSE_FNO', security_id: 'TEST', quantity: 75)"
puts 'â€¢ @vdm.get_orders                       # View orders'
puts 'â€¢ @vdm.get_positions                    # View positions'
puts '=' * 50

# You can add fixtures and/or initialization code here to make experimenting
# with your gem easier. You can also use a different console, if you like.

require 'irb'
IRB.start(__FILE__)
